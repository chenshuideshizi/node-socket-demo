# Node Socket.io Demo

### 一、WebSocket 解决了什么问题

**解决的问题**

- 客户端(浏览器)和服务器端进行通信，只能由客户端发起ajax请求，才能进行通信，服务器端无法主动向客户端推送信息
- 当出现类似体育赛事、聊天室、实时位置之类的场景时，客户端要获取服务器端的变化，就只能通过轮询(定时请求)来了解服务器端有没有新的信息变化

WebSocket的出现，让服务器端可以主动向服务器端发送信息，使得浏览器具备了实时双向通信的能力,这就是WebSocket解决的问题

### 二、websocket不稳定

WebSocket并不稳定，在使用一段时间后，可能会断开连接，貌似至今没有一个为何会断开连接的公论，所以我们需要让WebSocket保持连接状态。

解决方法有两种:

**方法一：WebSocket设置变量，判断是否手动关闭连接**

设置一个变量，在webSocket关闭/报错的回调中，判断是不是手动关闭的，如果不是的话，就重新连接。

- 优点：请求较少(相对于心跳连接)，易设置。
- 缺点：可能会导致丢失数据,在断开重连的这段时间中，恰好双方正在通信

**方法二: WebSocket心跳机制**

客户端就像心跳一样每隔固定的时间发送一次ping，来告诉服务器，我还活着，而服务器也会返回pong，来告诉客户端，服务器还活着。


### 三、关于WebSocket

下面是WebSocket.readyState的四个值(四种状态)：

- 0: 表示正在连接
- 1: 表示连接成功，可以通信了
- 2: 表示连接正在关闭
- 3: 表示连接已经关闭，或者打开连接失败



### 四、WebSocket的优点
- 双向通信
- 数据格式比较轻量，性能开销小，通信高效
    - 协议控制的数据包头部较小，而HTTP协议每次通信都需要携带完整的头部
- 更好的二进制支持
- 没有同源限制，客户端可以与任意服务器通信
- 与 HTTP 协议有着良好的兼容性。默认端口也是80和443，并且握手阶段采用 HTTP 协议，因此握手时不容易屏蔽，能通过各种 HTTP 代理服务器


### 五、socket.io

特点:

- 可靠性（如果无法建立 WebSocket 连接，则回退到 HTTP 长轮询）
- 自动重连
- 数据包缓冲
- 致谢
- 向所有客户端或部分客户端广播（我们称之为“room”）
- 多路复用（我们称之为“Namespace”）

